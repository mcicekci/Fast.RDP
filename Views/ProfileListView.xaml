<?xml version="1.0" encoding="utf-8"?>
<UserControl
    x:Class="FastRDP.Views.ProfileListView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:models="using:FastRDP.Models"
    mc:Ignorable="d">

    <UserControl.Resources>
        <CollectionViewSource x:Name="GroupedProfiles" 
                              IsSourceGrouped="True"
                              Source="{x:Bind GroupedProfilesList, Mode=OneWay}"/>
    </UserControl.Resources>

    <Grid>
        <ListView ItemsSource="{x:Bind GroupedProfiles.View, Mode=OneWay}"
                  SelectionMode="Single"
                  IsItemClickEnabled="True"
                  ItemClick="OnItemClick">
            
            <ListView.GroupStyle>
                <GroupStyle>
                    <GroupStyle.HeaderTemplate>
                        <DataTemplate>
                            <Grid Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                  Padding="12,8"
                                  Margin="0,8,0,4"
                                  CornerRadius="4">
                                <TextBlock Text="{Binding Key}" 
                                           FontWeight="SemiBold" 
                                           FontSize="16"
                                           Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"/>
                            </Grid>
                        </DataTemplate>
                    </GroupStyle.HeaderTemplate>
                </GroupStyle>
            </ListView.GroupStyle>

            <ListView.ItemTemplate>
                <DataTemplate x:DataType="models:RdpProfile">
                    <Grid Padding="12,8" ColumnSpacing="12">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <!-- İkon -->
                        <Border Grid.Column="0" 
                                Width="48" Height="48" 
                                Background="{ThemeResource AccentFillColorDefaultBrush}" 
                                CornerRadius="8">
                            <FontIcon Glyph="&#xE968;" 
                                      FontSize="24" 
                                      Foreground="White"/>
                        </Border>

                        <!-- Bilgiler -->
                        <StackPanel Grid.Column="1" 
                                    VerticalAlignment="Center" 
                                    Spacing="4">
                            <TextBlock Text="{x:Bind Name}" 
                                       FontWeight="SemiBold" 
                                       FontSize="15"/>
                            <TextBlock Text="{x:Bind Host}" 
                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}" 
                                       FontSize="13"/>
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <TextBlock Text="{x:Bind Username}" 
                                           Foreground="{ThemeResource TextFillColorTertiaryBrush}" 
                                           FontSize="12"/>
                                <TextBlock Text="|" 
                                           Foreground="{ThemeResource TextFillColorTertiaryBrush}" 
                                           FontSize="12"
                                           Visibility="{x:Bind Domain, Converter={StaticResource StringToVisibilityConverter}}"/>
                                <TextBlock Text="{x:Bind Domain}" 
                                           Foreground="{ThemeResource TextFillColorTertiaryBrush}" 
                                           FontSize="12"/>
                            </StackPanel>
                        </StackPanel>

                        <!-- Favori ve Son Kullanım -->
                        <StackPanel Grid.Column="2" 
                                    VerticalAlignment="Center" 
                                    HorizontalAlignment="Right"
                                    Spacing="4">
                            <FontIcon Glyph="&#xE735;" 
                                      FontSize="16" 
                                      Foreground="{ThemeResource SystemFillColorAttentionBrush}"
                                      Visibility="{x:Bind Favorite}"
                                      HorizontalAlignment="Right"/>
                            <TextBlock Text="{x:Bind LastUsed, Converter={StaticResource DateTimeToStringConverter}}" 
                                       FontSize="11" 
                                       Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                                       HorizontalAlignment="Right"
                                       Visibility="{x:Bind LastUsed, Converter={StaticResource NullToVisibilityConverter}}"/>
                        </StackPanel>
                    </Grid>
                </DataTemplate>
            </ListView.ItemTemplate>
        </ListView>
    </Grid>
</UserControl>

